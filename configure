#!/bin/bash

# Tole je skripta za pripravo Makefile sripte

# Parameters --------------------------------------------------------------------------------
ID=''
VERSION_ID=''
THEME_NAME='oomox-black'
ICONS_NAME='oomox-black'

# Function ----------------------------------------------------------------------------------
print_help() {
	echo -e 'NAME:'
	echo -e '\tconfigure - Configure Makefile'
	echo -e 'USAGE:'
	echo -e '\tconfigure [OPTIONS]'
	echo -e 'OPTIONS:'
	echo -e '\t-i  --icons\t\t[NAME]\t\tIcons theme name'
	echo -e '\t-t  --theme\t\t[NAME]\t\tTheme name'
	echo -e '\t-d  --dist\t\t[NAME]\t\tDistribution name'
	echo -e '\t-dv --dist_version\t[NAME]\t\tDistribution version'
	echo -e '\t-h  --help\t\t \t\tPrint this message'
	echo -e 'NAME:'
	echo -e '\tName represented with string'
}

all() {
	printf "all: depts git_init clean_repo"
	printf "\n" >> Makefile
}

git_init() {
	printf "git_init: depts\n\tgit init .\n\tgit remote add origin https://github.com/kb2623/linux-settings.git\n\tgit fetch\n\tgit submodule update --init --recursive\n" >> Makefile
	printf "\n" >> Makefile
}

git_update() {
	printf "git_update: git_init\n\tgit submodule update --recursive --remote\n" >> Makefile
	printf "\n" >> Makefile
}

neovim_init() {
	printf "neovim_init:\n\tln -s ~/.vimrc ~/.config/nvim/init.vim\n" >> Makefile
	printf "\n" >> Makefile
}

install_theme() {
	printf "install_theme: git_init\n\tcp -r .themes/${THEME_NAME} /usr/share/themes" >> Makefile
	printf "\n" >> Makefile
}

install_icons() {
	printf "install_icons: git_init\n\tcp -r .icons/${ICONS_NAME} /usr/share/icons" >> Makefile
	printf "\n" >> Makefile
}

install() {
	printf "install: install_theme install_icons\n" >> Makefile
	printf "\n" >> Makefile
}

clean_repo_deb() {
	printf "clean_repo:\n\tapt autoremove && apt autoclean" >> Makefile
	printf "\n" >> Makefile
}

clean_repo_arch() {
	printf "clean_repo:\n\tpacman -Rs $(pacman -Qtdq)\n"
	printf "\n" >> Makefile
}

debian_install() {
	all
	printf "update:\n\tapt update && apt upgrade\n" >> Makefile
	printf "\n" >> Makefile
	printf "depts: update\n\tapt install tmux vim-gtk awesome awesome-extras zsh git neovim neofetch gtk2-engines-murrine pipenv universal-ctags keepassxc\n\tgit clone https://github.com/lcpz/lain.git .config/awesome/lain\n" >> Makefile
	printf "\n" >> Makefile
	git_init
	git_update
	install_theme
	install_icons
	install
	clean_repo_deb
}

manjaro_install() {
	all
	printf "update:\n\tpacman -Syyuu\n" >> Makefile
	printf "\n" >> Makefile
	printf "depts: update\n\tpacman -S tmux neovim neofetch awesome zsh gvim git python-pipenv ctags keepassxc\n" >> Makefile
	printf "\n" >> Makefile
	printf "fonts: update\n\tpamac build nerd-fonts-fira-code awesome-freedesktop-git lain-git\n" >> Makefile
	printf "\n" >> Makefile
	git_init
	git_update
	install_theme
	install_icons
	install
	printf "update_mirrors:\n\tpacman-mirrors --geoip"
	printf "\n" >> Makefile
	clean_repo_arch
}

# Main ------------------------------------------------------------------------------------
while [[ "$#" -gt 0 ]]; do case $1 in
  -h|--help) print_help; exit 0;;
  -t|--theme) shift; THEME_NAME=$1;;
  -i|--icons) shift; ICONS_NAME=$1;;
  -d|--dist) shift; ID=$1;;
  -dv|--dist_version) shift; VERSION_ID=$1;;
  *) echo "Unknown parameter passed: $1"; exit 1;;
esac; shift; done

if [[ "${ID}" == '' ]]; then
	source /etc/os-release
fi

rm -f Makefile && touch Makefile

case "${ID}" in
	debian) debian_install;;
	manjaro) manjaro_install;;
esac

exit 0
